---
title: "SPRR_Bikarbonat"
author: "Lærke"
date: "1/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(visdat)
library(GGally)
library(Hmisc)
library(DMwR2)
library(data.table)
library(mltools)
library(ggfortify)
library(ggiraphExtra)
library(coronavirus)
library(lubridate)
library(plotly)
library(readxl)
require(readr)
library(zoo)
library(latex2exp)
library(fs)
library(fcuk)
colors = c(
    '#1f77b4',  # muted blue
    '#ff7f0e',  # safety orange
    '#2ca02c',  # cooked asparagus green
    '#d62728',  # brick red
    '#9467bd',  # muted purple
    '#8c564b',  # chestnut brown
    '#e377c2',  # raspberry yogurt pink
    '#7f7f7f',  # middle gray
    '#bcbd22',  # curry yellow-green
    '#17becf'   # blue-teal
)
```
## Summary of SPRR rejection data. {.tabset}

### Bicarbonate

Bicarbonate analyzed at lab øst 3. 


```{R SPRR_DATA, eval=FALSE, message=FALSE, include=FALSE}



SPRR_data <- read_excel("data/SPRR/SPRR_analysesvar_samlet.xlsx")

old_names_SPRR=colnames(SPRR_data) #Vi finder de latterlige navne kolonnerne i dataen har 
new_names_SPRR=c("No","Stream","Calcium","Sodium","Chloride","Sulphate","Silica","Bicarbonate") #Vi finder på nogle lidt bedre nogle
SPRR_data = SPRR_data %>% rename_at(vars(old_names_SPRR),~new_names_SPRR) #Vi ændrer navnene til de nye


#SPRR_data%>%mutate(rej_bicarbonat=())

#minfunktion = function(a,b,c){
#  res = (a+b)/c
#  
#  return(res)
#}

rejection = SPRR_data%>%filter(No==5 & Stream== "Feed" & Bicarboante)
rejection$Bicarbonate
  
  dat_1 %>%mutate(TMP=(p_avg0301+p_avg0302)/2-p_avg0501)%>%#Her regner vi TMP, som dplyr husker nu er en del af den data
  mutate(TMP_slid=rollapply(TMP,100,mean,align="right",fill=NA))%>%#Nu tager vi et glidende gennemsnit
  mutate(R = (1-(con0501/con0301))*100) %>%

#plot af bicarbonat

  plot_ly(data=SPRR_data, x=SPRR_data[1,],
          y=SPRR_data[7,]),
         color=~Stream,
          type='scatter',mode='markers',
          colors=c(colors[1],colors[2]))  %>%
      layout(title="Bicarbonate SPRR",
         yaxis=list(title="Concentration Bicarboante [mg/L]"),
         xaxis=list(title="Experiment no.")) 
 

 
 


```

```{R SPRR_DATA, echo=FALSE, message=FALSE}

SPRR_data_type=c()
SPRR_data <- read_excel("data/SPRR/SPRR_analysesvar_samlet.xlsx",2,
                        col_types="numeric")
                        #row_types=c("character","numeric","numeric","numeric","numeric","numeric","numeric"))
SPRR_data <- as.data.frame(SPRR_data[-1,-1])

row.names(SPRR_data) <- c("Calcium","Sodium","Chloride","Sulphate","Silica","Bicarbonate")
colnames(SPRR_data) <- c("Feed_1","Permeate_1",
                 "Feed_2","Permeate_2",
                 "Feed_3","Permeate_3",
                 "Feed_4","Permeate_4",
                 "Feed_5","Permeate_5",
                 "Feed_6","Permeate_6",
                 "Feed_7","Permeate_7",
                 "Feed_8","Permeate_8",
                 "Feed_9","Permeate_9",
                 "Feed_10","Permeate_10",
                 "Feed_11","Permeate_11",
                 "Feed_12","Permeate_12",
                 "Feed_13","Permeate_13",
                 "Feed_14","Permeate_14",
                 "Feed_15","Permeate_15",
                 "Feed_16","Permeate_16",
                 "Feed_17","Permeate_17",
                 "Feed_18","Permeate_18")
                 

SPRR_data%>%mutate(Rej_1=((1-(Feed_1/Permeate_1)*100))
                   
SPRR_rection=SPRR_data%>%mutate(Rej_5=((1-(Feed_5/Permeate_5)*100)))
               

Rej_function = function(feed,permeate){
  res = (1-(permeate/feed))*100
    return(res)
} 
Rej_function(2,4)


Rej_SPPR_data <- data.frame(NA_col=rep(NA,7))

for(i in 1:18){
 Rej_i<-Rej_function(SPRR_data[i],SPRR_data[i+1])
 print(Rej_i)
}

print(Rej_i)
  
  Rej_1=Rej_function(SPRR_data$Feed_1,SPRR_data$Permeate_1)
  
  Rej_5=Rej_function(SPRR_data$Feed_5,SPRR_data$Permeate_5)
  
                   
                   
#minfunktion = function(a,b,c){
#  res = (a+b)/c
#  
#  return(res)
#}

rejection = SPRR_data%>%filter(No==5 & Stream== "Feed" & Bicarboante)
rejection$Bicarbonate
  
  dat_1 %>%mutate(TMP=(p_avg0301+p_avg0302)/2-p_avg0501)%>%#Her regner vi TMP, som dplyr husker nu er en del af den data
  mutate(TMP_slid=rollapply(TMP,100,mean,align="right",fill=NA))%>%#Nu tager vi et glidende gennemsnit
  mutate(R = (1-(con0501/con0301))*100) %>%

#plot af bicarbonat

  plot_ly(data=SPRR_data, x=~No,
          y=~Bicarbonate,
         color=~Stream,
          type='scatter',mode='markers',
          colors=c(colors[1],colors[2]))  %>%
      layout(title="Bicarbonate SPRR",
         yaxis=list(title="Concentration Bicarboante [mg/L]"),
         xaxis=list(title="Experiment no.")) 
 

 
 


```