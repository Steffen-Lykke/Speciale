---
title: "stor_tabel"
author: "LÃ¦rke"
date: "27/5/2022"
output: 
  html_document:
    toc: true
    toc_depth: 3
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning=F,message=F)
library(plyr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(visdat)
library(GGally)
library(Hmisc)
library(DMwR2)
library(data.table)
library(mltools)
library(ggfortify)
library(ggiraphExtra)
library(coronavirus)
library(lubridate)
library(plotly)
#library(naniar)
library(readxl)
require(readr)
library(zoo)
library(latex2exp)
library(fs)
library(plyr)
library(matrixStats)
library(haven)
library(sjmisc)
require(gridExtra)
require(ggpubr)

colors = c(
  '#1f77b4',  # muted blue
  '#ff7f0e',  # safety orange
  '#2ca02c',  # cooked asparagus green
  '#d62728',  # brick red
  '#9467bd',  # muted purple
  '#8c564b',  # chestnut brown
  '#e377c2',  # raspberry yogurt pink
  '#7f7f7f',  # middle gray
  '#bcbd22',  # curry yellow-green
  '#17becf'   # blue-teal
)
```


```{r import af data rejection, echo=FALSE}

#multisalt: 
multi_salt_rejection = read.table(file='data/multi_salt_rejection.csv', header = T,sep = "\t",stringsAsFactors = T)
colnames(multi_salt_rejection)=c("Filtration","Time","Recovery","Species","Rejection","Std")
multi_salt_rejection$Type="Synthetic"
multi_salt_rejection$A_B="A"
multi_salt_rejection$System="Lab_scale"

#ICR:
ICR_rejection = read.table(file='data/ICR_rejection.csv', header = T,sep = "\t",stringsAsFactors = T)
colnames(ICR_rejection)=c("Filtration","Time","Recovery","Species","Rejection","Std")
ICR_rejection$Type="Synthetic"
ICR_rejection$A_B=c(rep("A",75),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4))
ICR_rejection$System="Lab_scale"

#FCT:
FCT_rejection = read.table(file='data/FCT_rejection.csv', header = T,sep = "\t",stringsAsFactors = T)
colnames(FCT_rejection)=c("Filtration","Time","Recovery","Species","Rejection","Std")
FCT_rejection$Type="Authentic"
FCT_rejection$A_B=c(rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",4),rep("B",4),rep("A",5),rep("B",5),rep("A",5),rep("B",5))
FCT_rejection$System="Lab_scale"

#pilot:
Pilot_rejection = read.table(file='data/Pilot_rejection.csv', header = T,sep = "\t",stringsAsFactors = T)
colnames(Pilot_rejection)=c("Filtration","Time","Recovery","Species","Rejection","Std")
Pilot_rejection$Species=c(rep("Cl",11),rep("SO4",11),rep("Na",11),rep("Ca",11),rep("SiO2",11))
Pilot_rejection$Type="Authentic"
Pilot_rejection$A_B=c(rep("A",6),rep("B",5),rep("A",6),rep("B",5),rep("A",6),rep("B",5),rep("A",6),rep("B",5),rep("A",6),rep("B",5))
Pilot_rejection$System="Pilot_scale"

Rejection_data_samlet=rbind(multi_salt_rejection,ICR_rejection,FCT_rejection,Pilot_rejection)

Rejection_data_samlet%>%filter(Filtration=="ID:8A",Time==1)

```
```{r plot, echo=FALSE}

ioner=c(expression(Ca^{textstyle("2+")}),expression(Cl^{textstyle("-")}),expression(Na^{textstyle("+")}),expression(SiO[2]),expression(SO[4]^{textstyle("2-")}))
library(RColorBrewer)
#brewer.pal(n=5,"Set1")
colors3=c( 
  
   '#d62728',  # brick red
  '#9467bd',  # muted purple 
 '#ff7f0e',  # safety orange
 '#8c564b',  # chestnut brown
   '#e377c2',  # raspberry yogurt pink
  '#1f77b4',  # muted blue 
  '#2ca02c',  # cooked asparagus green
  '#17becf'   # blue-teal
 )
  
  
#  '#d62728',  # brick red
#  '#1f77b4',  # muted blue 
#  '#2ca02c',  # cooked asparagus green
#  '#9467bd',  # muted purple  
#  '#ff7f0e',  # safety orange
#  '#8c564b',  # chestnut brown
#  '#e377c2',  # raspberry yogurt pink
#  '#7f7f7f',  # middle gray
#  '#bcbd22',  # curry yellow-green
#  '#17becf'   # blue-teal
#)
#vi klipper lige alle B filtreringer af. 

Cl_authentic_synthetic_plot=Rejection_data_samlet%>%filter(Species=="Cl")%>%filter(A_B!="B")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+#scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Type),rows = vars(Species),scale="free")+
 # scale_y_continuous(limits=c(-60, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")
Cl_authentic_synthetic_plot
ggplotly(Cl_authentic_synthetic_plot)

SIO2_authentic_synthetic_plot=Rejection_data_samlet%>%filter(Species=="SiO2")%>%filter(A_B!="B")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+#scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Type),rows = vars(Species),scale="free")+
  scale_y_continuous(limits=c(0, 100), breaks=c(0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")
SIO2_authentic_synthetic_plot
ggplotly(SIO2_authentic_synthetic_plot)


Rejection_data_samlet%>%filter(Species!="Cl",Species!="SiO2",Species!="Mg")%>%filter(A_B!="B")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Type),rows = vars(Species),scale="free")+
  scale_y_continuous(limits=c(0, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")


Rejection_data_samlet%>%filter(Species=="Cl"|Species=="SiO2")%>%filter(Type=="Authentic")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(A_B),rows = vars(Species),scale="free")+
 # scale_y_continuous(limits=c(0, 100), breaks=c(0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")


Rejection_data_samlet%>%filter(Species=="Cl"|Species=="SiO2")%>%filter(A_B=="A")%>%filter(Type=="Authentic")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(System),rows = vars(Species),scale="free")+
 # scale_y_continuous(limits=c(-60, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")



B_authentic_synthetic_plot=Rejection_data_samlet%>%filter(A_B=="B")%>%filter(Species!="Mg")%>%
ggplot(aes(x=Recovery,y=Rejection,color=Filtration))+
  geom_point()+geom_line()+#scale_color_manual(values =colors3)+
 # scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Rejection-(Rejection*Std), ymax=Rejection+(Rejection*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Species),scale="free")+
 # scale_y_continuous(limits=c(-60, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Rejection [%]", color="Filtration")
B_authentic_synthetic_plot
ggplotly(B_authentic_synthetic_plot)


```



```{r import af data concentration, echo=FALSE}

#brug denne til export af tabels. 
#write.table(M9.2,file='data/M9.2_df.csv',col.names = T,row.names = F,sep="\t")


#brug denne til import: 
#SPRR = read.table(file='data/multi_salt_rejection', header = T,sep = "\t",stringsAsFactors = T)

#multisalt: 
multisalt_concentration = read.table(file='data/multisalt_concentration.csv', header = T,sep = "\t",stringsAsFactors = T)
multisalt_concentration$Mw=c(rep(35.45,39),rep(96.06,39),rep(40.078,39),rep(22.99,39),rep(60.08,43))
colnames(multisalt_concentration)=c("Filtration","Time","Stream","Recovery","Species","Concentration","Std","Plot","Mw")
multisalt_concentration$Type="Synthetic"
multisalt_concentration$System="Lab_scale"

#ICR:
ICR_concentration = read.table(file='data/ICR_concentration.csv', header = T,sep = "\t",stringsAsFactors = T)
ICR_concentration=ICR_concentration[,c(1:3,10,7,9,6,11,8)]
colnames(ICR_concentration)=c("Filtration","Time","Stream","Recovery","Species","Concentration","Std","Plot","Mw")
ICR_concentration$Type="Synthetic"
ICR_concentration$System="Lab_scale"

#FCT:
FCT_concentration = read.table(file='data/FCT_concentration.csv', header = T,sep = "\t",stringsAsFactors = T)
FCT_concentration=FCT_concentration[,c(1:3,10,4,5,6,11,7)]
colnames(FCT_concentration)=c("Filtration","Time","Stream","Recovery","Species","Concentration","Std","Plot","Mw")
FCT_concentration$Type="Authentic"
FCT_concentration$System="Lab_scale"
FCT_concentration$Concentration=FCT_concentration$Concentration/FCT_concentration$Mw

#pilot:
Pilot_concentration = read.table(file='data/Pilot_concentration.csv', header = T,sep = "\t",stringsAsFactors = T)
Pilot_concentration$Mw=c(rep(35.45,34),rep(96.06,34),rep(22.99,34),rep(40.078,34),rep(60.08,34))
Pilot_concentration$Plot=c(rep("Ca, Cl, SiO2, SO4",68),rep("Na",34),rep("Ca, Cl, SiO2, SO4",68))
colnames(Pilot_concentration)=c("Filtration","Time","Stream","Recovery","Species","Concentration","Std","Plot","Mw")

Pilot_concentration$Species=c(rep("Cl",34),rep("SO4",34),rep("Na",34),rep("Ca",34),rep("SiO2",34))
Pilot_concentration$Type="Authentic"
Pilot_concentration$System="Pilot_scale"

concentration_data_samlet=rbind(multisalt_concentration,ICR_concentration,FCT_concentration,Pilot_concentration)

concentration_data_samlet%>%filter(Filtration=="ID:8A",Time==1 , Stream=="Feed")

```
 Concentration of filtraiton A divided into cations and anions. 

```{r plot concentraiton, echo=FALSE}


concentration_Feed_plot=concentration_data_samlet%>%filter(Stream=="Feed")%>%filter(Species=="Cl"|Species=="SiO2"|Species=="SO4")%>%filter(Filtration!="ID:5B",Filtration!="ID:4B",Filtration!="ID:6B",Filtration!="ID:7B",Filtration!="ID:8B")%>%
ggplot(aes(x=Recovery,y=Concentration,color=Filtration))+
  geom_point()+geom_line()+#scale_color_manual(values =colors3)+
  #scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Concentration-(Concentration*Std), ymax=Concentration+(Concentration*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Type),rows = vars(Species),scale="free")+
 # scale_y_continuous(limits=c(-60, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Concentration [%]", color="Filtration")
concentration_Feed_plot
ggplotly(concentration_Feed_plot)

Cation_concentration_Feed_plot=concentration_data_samlet%>%filter(Stream=="Feed")%>%filter(Species=="Ca"|Species=="Na")%>%
  filter(Filtration!="ID:5B",Filtration!="ID:4B",Filtration!="ID:6B",Filtration!="ID:7B",Filtration!="ID:8B")%>%
ggplot(aes(x=Recovery,y=Concentration,color=Filtration))+
  geom_point()+geom_line()+#scale_color_manual(values =colors3)+
  #scale_color_brewer(palette= "Spectral")+
  geom_hline(yintercept=0)+
    geom_errorbar(aes(x=Recovery,ymin=Concentration-(Concentration*Std), ymax=Concentration+(Concentration*Std),color=Filtration), width=1, position=position_dodge(0.05))+theme(legend.text.align=0)+
    facet_grid(cols=vars(Type),rows = vars(Species),scale="free")+
 # scale_y_continuous(limits=c(-60, 105), breaks=c(-60,-40,-20,0,20, 40,60,80,100 ))+
   scale_x_continuous(limits=c(0, 90), breaks=c(0,20, 40,60,80 ))+labs(x="Water Recovery [%]",y="Concentration [%]", color="Filtration")
Cation_concentration_Feed_plot
ggplotly(Cation_concentration_Feed_plot)

concentration_initial_plot=concentration_data_samlet%>%filter(Time==0,Stream=="Feed")%>%filter(Species=="Cl"|Species=="SiO2"|Species=="SO4")%>%filter(Filtration!="5B")%>%
ggplot(aes(x=Filtration, y=Concentration, fill=Species, )) +geom_bar(stat="identity",
  width = 0.5, position=position_dodge())+ labs(x="Species",y="Concentraiton mM")+
  #scale_y_continuous(limits=c(0, 20), breaks=c(0, 5,10,15,20 ))+
  #scale_x_continuous(limits=c(0, 95), breaks=c(20, 40,60,80 ))+
  ggtitle("ID:8A/8B")
concentration_initial_plot


```
